import{c as A,r as d,j as e,i as Y,s as v,t as r,p as D,B as o,U as F,C as I,e as _,f as T,a as L}from"./index-DOHKno-r.js";import{I as u}from"./input-CGU9Bpoq.js";import{L as i}from"./label-D7XrhLbW.js";import{S as P,b as k,c as C,d as S,e as t}from"./select-IkKipNiB.js";import{P as Z}from"./index-CXKmYhPZ.js";import{A as ee,a as se,T as ae,b as re,c as te,d as le,e as ne,f as ie,g as ce,h as oe}from"./alert-dialog-OV7inE3r.js";import{A as de}from"./arrow-left-pJDo2vDd.js";import{S as he}from"./square-pen-CcKtJ4oM.js";import{S as xe}from"./save-cIMTOwNp.js";import{X as me}from"./x-CVm8_-WJ.js";import"./index-jkJ68Hes.js";import"./index-CYkPx1nH.js";import"./Combination-BTitTim-.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],$=A("eye-off",ue);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],G=A("eye",je);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],fe=A("settings",pe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],R=A("shield",ve);var we="Separator",q="horizontal",ge=["horizontal","vertical"],H=d.forwardRef((h,p)=>{const{decorative:x,orientation:a=q,...g}=h,w=Ne(a)?a:q,N=x?{role:"none"}:{"aria-orientation":w==="vertical"?w:void 0,role:"separator"};return e.jsx(Z.div,{"data-orientation":w,...N,...g,ref:p})});H.displayName=we;function Ne(h){return ge.includes(h)}var ye=H;function be({className:h,orientation:p="horizontal",decorative:x=!0,...a}){return e.jsx(ye,{"data-slot":"separator-root",decorative:x,orientation:p,className:Y("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",h),...a})}function Ge({onNavigate:h,onLogout:p,user:x}){const[a,g]=d.useState(null),[w,O]=d.useState(!0),[N,E]=d.useState(!1),[V,M]=d.useState(!1),[n,y]=d.useState(null),[c,b]=d.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[f,z]=d.useState({current:!1,new:!1,confirm:!1}),[U,B]=d.useState(!1);d.useEffect(()=>{J()},[]);const J=async()=>{try{const{data:{session:s}}=await v.auth.getSession();if(!s?.access_token){r.error("Необходима авторизация"),h("auth");return}const l=await fetch(`https://${D}.supabase.co/functions/v1/make-server-c6c9ad1a/profile`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(l.ok){const j=await l.json();g(j.profile),y(j.profile)}else r.error("Ошибка загрузки профиля")}catch(s){console.error("Ошибка загрузки профиля:",s),r.error("Ошибка загрузки профиля")}finally{O(!1)}},W=async()=>{if(n){M(!0);try{const{data:{session:s}}=await v.auth.getSession();if(!s?.access_token){r.error("Необходима авторизация");return}const l=await fetch(`https://${D}.supabase.co/functions/v1/make-server-c6c9ad1a/profile`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify(n)});if(l.ok){const j=await l.json();g(j.profile),y(j.profile),E(!1),r.success("Профиль обновлен!")}else r.error("Ошибка сохранения профиля")}catch(s){console.error("Ошибка сохранения профиля:",s),r.error("Ошибка сохранения профиля")}finally{M(!1)}}},X=async()=>{if(!c.currentPassword||!c.newPassword){r.error("Заполните все поля");return}if(c.newPassword!==c.confirmPassword){r.error("Новые пароли не совпадают");return}if(c.newPassword.length<8){r.error("Новый пароль должен содержать минимум 8 символов");return}B(!0);try{const{data:s,error:l}=await v.auth.signInWithPassword({email:x.email,password:c.currentPassword});if(l){r.error("Неверный текущий пароль");return}const{error:j}=await v.auth.updateUser({password:c.newPassword});if(j){r.error("Ошибка смены пароля");return}b({currentPassword:"",newPassword:"",confirmPassword:""}),r.success("Пароль успешно изменен!")}catch(s){console.error("Ошибка смены пароля:",s),r.error("Ошибка смены пароля")}finally{B(!1)}},K=async()=>{try{const{data:{session:s}}=await v.auth.getSession();if(!s?.access_token){r.error("Необходима авторизация");return}(await fetch(`https://${D}.supabase.co/functions/v1/make-server-c6c9ad1a/delete-account`,{method:"DELETE",headers:{Authorization:`Bearer ${s.access_token}`}})).ok?(await v.auth.admin.deleteUser(x.id),r.success("Аккаунт удален"),p()):r.error("Ошибка удаления аккаунта")}catch(s){console.error("Ошибка удаления аккаунта:",s),r.error("Ошибка удаления аккаунта")}},m=(s,l)=>{n&&y({...n,[s]:l})},Q=()=>{y(a),E(!1)};return w?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>h("home"),children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Аккаунт"})]}),e.jsx(F,{className:"w-6 h-6 text-primary"})]}),e.jsxs(I,{children:[e.jsx(_,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Личная информация"]}),N?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{size:"sm",onClick:W,disabled:V,children:V?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:Q,children:e.jsx(me,{className:"w-4 h-4"})})]}):e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>E(!0),children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Редактировать"]})]})}),e.jsx(L,{className:"space-y-4",children:N&&n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Имя"}),e.jsx(u,{value:n.name||"",onChange:s=>m("name",s.target.value),placeholder:"Ваше имя"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Email"}),e.jsx(u,{value:n.email||x.email,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Возраст"}),e.jsx(u,{type:"number",value:n.age||"",onChange:s=>m("age",parseInt(s.target.value)),placeholder:"25"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Рост (см)"}),e.jsx(u,{type:"number",value:n.height||"",onChange:s=>m("height",parseInt(s.target.value)),placeholder:"175"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Вес (кг)"}),e.jsx(u,{type:"number",value:n.weight||"",onChange:s=>m("weight",parseInt(s.target.value)),placeholder:"70"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Основная цель"}),e.jsxs(P,{value:n.primaryGoal||"",onValueChange:s=>m("primaryGoal",s),children:[e.jsx(k,{children:e.jsx(C,{placeholder:"Выберите цель"})}),e.jsxs(S,{children:[e.jsx(t,{value:"снижение-веса",children:"Снижение веса"}),e.jsx(t,{value:"набор-мышц",children:"Набор мышечной массы"}),e.jsx(t,{value:"увеличение-силы",children:"Увеличение силы"}),e.jsx(t,{value:"выносливость",children:"Выносливость"}),e.jsx(t,{value:"гибкость",children:"Гибкость"}),e.jsx(t,{value:"общая-форма",children:"Общая физическая форма"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Уровень подготовки"}),e.jsxs(P,{value:n.fitnessLevel||"",onValueChange:s=>m("fitnessLevel",s),children:[e.jsx(k,{children:e.jsx(C,{placeholder:"Выберите уровень"})}),e.jsxs(S,{children:[e.jsx(t,{value:"начинающий",children:"Начинающий"}),e.jsx(t,{value:"средний",children:"Средний"}),e.jsx(t,{value:"продвинутый",children:"Продвинутый"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Частота тренировок"}),e.jsxs(P,{value:n.workoutFrequency||"",onValueChange:s=>m("workoutFrequency",s),children:[e.jsx(k,{children:e.jsx(C,{placeholder:"Выберите частоту"})}),e.jsxs(S,{children:[e.jsx(t,{value:"2-3",children:"2-3 раза в неделю"}),e.jsx(t,{value:"3-4",children:"3-4 раза в неделю"}),e.jsx(t,{value:"4-5",children:"4-5 раз в неделю"}),e.jsx(t,{value:"6-7",children:"6-7 раз в неделю"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Длительность тренировки"}),e.jsxs(P,{value:n.workoutDuration||"",onValueChange:s=>m("workoutDuration",s),children:[e.jsx(k,{children:e.jsx(C,{placeholder:"Выберите длительность"})}),e.jsxs(S,{children:[e.jsx(t,{value:"20-30",children:"20-30 минут"}),e.jsx(t,{value:"30-45",children:"30-45 минут"}),e.jsx(t,{value:"45-60",children:"45-60 минут"}),e.jsx(t,{value:"60+",children:"60+ минут"})]})]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Имя:"}),e.jsx("span",{children:a?.name||"Не указано"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Email:"}),e.jsx("span",{children:a?.email||x.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Возраст:"}),e.jsx("span",{children:a?.age||"Не указано"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Рост:"}),e.jsx("span",{children:a?.height?`${a.height} см`:"Не указано"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Вес:"}),e.jsx("span",{children:a?.weight?`${a.weight} кг`:"Не указано"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Цель:"}),e.jsx("span",{children:a?.primaryGoal==="снижение-веса"?"Снижение веса":a?.primaryGoal==="набор-мышц"?"Набор мышечной массы":a?.primaryGoal==="увеличение-силы"?"Увеличение силы":a?.primaryGoal==="выносливость"?"Выносливость":a?.primaryGoal==="гибкость"?"Гибкость":a?.primaryGoal==="общая-форма"?"Общая физическая форма":a?.primaryGoal||"Не указано"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Уровень:"}),e.jsx("span",{children:a?.fitnessLevel==="начинающий"?"Начинающий":a?.fitnessLevel==="средний"?"Средний":a?.fitnessLevel==="продвинутый"?"Продвинутый":a?.fitnessLevel||"Не указано"})]})]})})]}),e.jsxs(I,{children:[e.jsx(_,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Безопасность"]})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Текущий пароль"}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{type:f.current?"text":"password",value:c.currentPassword,onChange:s=>b(l=>({...l,currentPassword:s.target.value})),placeholder:"Введите текущий пароль"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>z(s=>({...s,current:!s.current})),children:f.current?e.jsx($,{className:"w-4 h-4"}):e.jsx(G,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Новый пароль"}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{type:f.new?"text":"password",value:c.newPassword,onChange:s=>b(l=>({...l,newPassword:s.target.value})),placeholder:"Введите новый пароль"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>z(s=>({...s,new:!s.new})),children:f.new?e.jsx($,{className:"w-4 h-4"}):e.jsx(G,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Подтвердите новый пароль"}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{type:f.confirm?"text":"password",value:c.confirmPassword,onChange:s=>b(l=>({...l,confirmPassword:s.target.value})),placeholder:"Повторите новый пароль"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>z(s=>({...s,confirm:!s.confirm})),children:f.confirm?e.jsx($,{className:"w-4 h-4"}):e.jsx(G,{className:"w-4 h-4"})})]})]}),e.jsxs(o,{onClick:X,disabled:U,className:"w-full",children:[U?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2"}):e.jsx(R,{className:"w-4 h-4 mr-2"}),"Изменить пароль"]})]})]}),e.jsx(be,{}),e.jsxs(I,{children:[e.jsx(_,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Управление аккаунтом"]})}),e.jsxs(L,{className:"space-y-4",children:[e.jsx(o,{onClick:p,variant:"outline",className:"w-full",children:"Выйти из аккаунта"}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(o,{variant:"destructive",className:"w-full",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Удалить аккаунт"]})}),e.jsxs(re,{children:[e.jsxs(te,{children:[e.jsx(le,{children:"Удалить аккаунт?"}),e.jsx(ne,{children:"Это действие нельзя отменить. Все ваши данные, планы тренировок и прогресс будут удалены навсегда."})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Отмена"}),e.jsx(oe,{onClick:K,className:"bg-destructive text-destructive-foreground",children:"Удалить аккаунт"})]})]})]})]})]})]})}export{Ge as AccountPage};
