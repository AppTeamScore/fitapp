import{c as C,s as R,p as B,r as x,t as E,j as e,C as g,a as y,B as f,e as J,f as M,R as z}from"./index-B7RkBDmu.js";import{P as A}from"./progress-XNUHpmQg.js";import{B as N}from"./badge-4HUg1KV1.js";import{V as D,P as G}from"./VideoPlayer-C4Wpzf3M.js";import{P as L}from"./play-BI_r92eU.js";import"./index-By6Rn9_c.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],H=C("info",F);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]],U=C("skip-forward",V),K=`https://${B}.supabase.co/functions/v1/make-server-c6c9ad1a`,Q={async request(n,c={}){try{const{data:{session:s}}=await R.auth.getSession(),h={"Content-Type":"application/json",...c.headers};s?.access_token&&(h.Authorization=`Bearer ${s.access_token}`);const o=await fetch(`${K}${n}`,{...c,headers:h});if(!o.ok){let i="API request failed";try{i=(await o.json()).error||i}catch{i=`HTTP ${o.status}: ${o.statusText}`}throw new Error(i)}return o.json()}catch(s){throw s instanceof TypeError&&s.message.includes("Failed to fetch")?new Error("Не удается подключиться к серверу. Проверьте подключение к интернету."):s}},async getProfile(){return this.request("/profile")},async updateProfile(n){return this.request("/profile",{method:"PUT",body:JSON.stringify(n)})},async getWorkoutPlan(){return this.request("/workout-plan")},async generateWorkoutPlan(n){return this.request("/generate-workout-plan",{method:"POST",body:JSON.stringify(n)})},async saveWorkoutProgress(n){return this.request("/workout-progress",{method:"POST",body:JSON.stringify(n)})},async getWorkoutProgress(){return this.request("/workout-progress")}};function re({onNavigate:n,workout:c}){const[s,h]=x.useState(0),[o,i]=x.useState(c?.exercises_list?.[0]?.duration||30),[u,v]=x.useState(!1),[m,j]=x.useState(!1),[p,S]=x.useState(0),[k,b]=x.useState(null),t=c?.exercises_list||[];console.log("TimerPage получена тренировка:",c),console.log("Exercises list:",t);const r=t[s]||t[0],l=t.length;x.useEffect(()=>{let a;return u&&o>0?a=setInterval(()=>{i(d=>d-1)},1e3):o===0&&(m?(j(!1),S(d=>d+1),s<l-1?(h(d=>d+1),i(t[s+1]?.duration||30)):(v(!1),I())):(j(!0),i(r?.rest||15))),()=>clearInterval(a)},[u,o,m,s,t,l,r?.rest,n]);const I=async()=>{const a=new Date,d=k?Math.round((a.getTime()-k.getTime())/1e3/60):c?.duration||0,w={date:a.toISOString(),type:c?.category||"Тренировка",name:c?.name||"Тренировка",duration:d,completedExercises:p,totalExercises:t.length},T=JSON.parse(localStorage.getItem("completedWorkouts")||"[]");T.push(w),localStorage.setItem("completedWorkouts",JSON.stringify(T));try{await Q.saveWorkoutProgress({workoutName:c?.name||"Тренировка",completedExercises:p,totalExercises:t.length,duration:d,date:a.toISOString(),exercises:t.slice(0,p).map(P=>({name:P.name,completed:!0}))}),E.success("Тренировка завершена! Прогресс сохранен.")}catch(P){console.error("Ошибка сохранения прогресса:",P),E.success("Тренировка завершена! Данные сохранены локально.")}n("home")},W=()=>{!u&&!k&&b(new Date),v(!u)},O=()=>{v(!1),j(!1),h(0),i(t[0]?.duration||30),S(0),b(null)},_=()=>{s<l-1&&(j(!1),h(a=>a+1),i(t[s+1]?.duration||30),S(a=>a+1))},$=a=>{const d=Math.floor(a/60),w=a%60;return`${d.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`},q=l>0?p/l*100:0;return!t||t.length===0?e.jsx("div",{className:"p-4 space-y-6 min-h-screen flex items-center justify-center",children:e.jsx(g,{className:"text-center p-6",children:e.jsxs(y,{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Нет упражнений"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Тренировка не содержит упражнений для выполнения."}),e.jsx(f,{onClick:()=>n("home"),children:"Вернуться на главную"})]})})}):e.jsxs("div",{className:"p-4 space-y-6 min-h-screen bg-gradient-to-b from-primary/5 to-background",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:c?.name||"Таймер тренировки"}),e.jsx(f,{onClick:()=>n("home"),variant:"ghost",children:"Завершить"})]}),e.jsx(g,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Прогресс тренировки"}),e.jsxs("span",{children:[p,"/",l]})]}),e.jsx(A,{value:q,className:"h-2"})]})})}),e.jsxs(g,{className:"text-center",children:[e.jsxs(J,{children:[e.jsx(M,{className:"text-2xl mb-2",children:m?"Отдых":r?.name||"Упражнение"}),!m&&r&&e.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[e.jsx(N,{variant:"secondary",className:"text-xs",children:r.category}),e.jsx(N,{variant:"outline",className:"text-xs",children:r.muscleGroups?.join(", ")})]})]}),e.jsxs(y,{className:"space-y-6",children:[!m&&r?.video&&e.jsx("div",{className:"mb-4",children:e.jsx(D,{videoSrc:r.video,exerciseName:r.name,autoPlay:u,loop:!0,muted:!0})}),e.jsx("div",{className:"text-6xl font-bold text-primary",children:$(o)}),!m&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Упражнение ",s+1," из ",l]}),r?.muscleGroups&&e.jsxs("div",{className:"flex items-center justify-center text-sm text-muted-foreground",children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"Работают: ",r.muscleGroups.join(", ")]}),r?.weight&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Вес: ",r.weight," кг"]}),r?.sets&&r?.reps&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.sets," подходов × ",r.reps," повторений"]})]}),m&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Приготовьтесь к следующему упражнению"}),s<l-1&&t[s+1]&&e.jsxs("p",{className:"font-semibold",children:["Следующее: ",t[s+1].name]})]})]})]}),!m&&s<l-1&&t[s+1]&&e.jsx(g,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Следующее упражнение:"}),e.jsx("p",{className:"font-semibold",children:t[s+1].name}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(N,{variant:"secondary",className:"text-xs",children:t[s+1].category}),e.jsxs(N,{variant:"outline",className:"text-xs",children:[t[s+1].duration,"с"]})]})]})})}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(f,{onClick:W,size:"lg",className:"rounded-full w-16 h-16",children:u?e.jsx(G,{className:"h-6 w-6"}):e.jsx(L,{className:"h-6 w-6"})}),e.jsx(f,{onClick:O,variant:"outline",size:"lg",className:"rounded-full w-16 h-16",children:e.jsx(z,{className:"h-6 w-6"})}),e.jsx(f,{onClick:_,variant:"outline",size:"lg",className:"rounded-full w-16 h-16",disabled:s>=l-1,children:e.jsx(U,{className:"h-6 w-6"})})]})]})}export{re as TimerPage};
