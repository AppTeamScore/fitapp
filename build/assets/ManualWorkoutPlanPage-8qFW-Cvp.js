import{c as ie,r as l,u as V,j as e,i as je,B as N,s as te,p as se,C as pe,e as xe,f as ve,a as ge,t as T}from"./index-B7RkBDmu.js";import{I as F}from"./input-D0dNSjS9.js";import{L as A}from"./label-D7l1fsoW.js";import{f as Fe,S as oe,b as ne,c as ae,d as le,e as Y,C as be}from"./select-CiD_DPgS.js";import{B as Xe}from"./badge-4HUg1KV1.js";import{c as Ve,P as G}from"./index-By6Rn9_c.js";import{P as K,c as $,a as O,b as Ye}from"./index-CXZW0Of0.js";import{u as Ue}from"./index-CIMocV2O.js";import{g as Ge,b as U}from"./exercises-BGJW1MrG.js";import{X as ye}from"./x-9iDdO0Of.js";import{C as Je}from"./clock-B8yeLv0_.js";import{A as Ze}from"./arrow-left-DU8czwo7.js";import{S as ce}from"./save-DHRjesAf.js";import{S as Ke}from"./square-pen-BaPZaYOj.js";import{P as Se}from"./plus-yrttBv70.js";import"./Combination-D8diDoBo.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],er=ie("repeat",Qe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]],tr=ie("weight",rr);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],or=ie("zap",sr);function nr(r,o){return l.useReducer((t,c)=>o[t][c]??t,r)}var de="ScrollArea",[Ne,Hr]=Ve(de),[ar,E]=Ne(de),Ce=l.forwardRef((r,o)=>{const{__scopeScrollArea:t,type:c="hover",dir:n,scrollHideDelay:a=600,...i}=r,[u,h]=l.useState(null),[m,f]=l.useState(null),[v,p]=l.useState(null),[g,y]=l.useState(null),[z,M]=l.useState(null),[P,L]=l.useState(0),[W,R]=l.useState(0),[_,H]=l.useState(!1),[q,B]=l.useState(!1),b=V(o,I=>h(I)),C=Ue(n);return e.jsx(ar,{scope:t,type:c,dir:C,scrollHideDelay:a,scrollArea:u,viewport:m,onViewportChange:f,content:v,onContentChange:p,scrollbarX:g,onScrollbarXChange:y,scrollbarXEnabled:_,onScrollbarXEnabledChange:H,scrollbarY:z,onScrollbarYChange:M,scrollbarYEnabled:q,onScrollbarYEnabledChange:B,onCornerWidthChange:L,onCornerHeightChange:R,children:e.jsx(G.div,{dir:C,...i,ref:b,style:{position:"relative","--radix-scroll-area-corner-width":P+"px","--radix-scroll-area-corner-height":W+"px",...r.style}})})});Ce.displayName=de;var Pe="ScrollAreaViewport",Ee=l.forwardRef((r,o)=>{const{__scopeScrollArea:t,children:c,nonce:n,...a}=r,i=E(Pe,t),u=l.useRef(null),h=V(o,u,i.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(G.div,{"data-radix-scroll-area-viewport":"",...a,ref:h,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...r.style},children:e.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:c})})]})});Ee.displayName=Pe;var D="ScrollAreaScrollbar",Te=l.forwardRef((r,o)=>{const{forceMount:t,...c}=r,n=E(D,r.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:i}=n,u=r.orientation==="horizontal";return l.useEffect(()=>(u?a(!0):i(!0),()=>{u?a(!1):i(!1)}),[u,a,i]),n.type==="hover"?e.jsx(lr,{...c,ref:o,forceMount:t}):n.type==="scroll"?e.jsx(cr,{...c,ref:o,forceMount:t}):n.type==="auto"?e.jsx(Ae,{...c,ref:o,forceMount:t}):n.type==="always"?e.jsx(ue,{...c,ref:o}):null});Te.displayName=D;var lr=l.forwardRef((r,o)=>{const{forceMount:t,...c}=r,n=E(D,r.__scopeScrollArea),[a,i]=l.useState(!1);return l.useEffect(()=>{const u=n.scrollArea;let h=0;if(u){const m=()=>{window.clearTimeout(h),i(!0)},f=()=>{h=window.setTimeout(()=>i(!1),n.scrollHideDelay)};return u.addEventListener("pointerenter",m),u.addEventListener("pointerleave",f),()=>{window.clearTimeout(h),u.removeEventListener("pointerenter",m),u.removeEventListener("pointerleave",f)}}},[n.scrollArea,n.scrollHideDelay]),e.jsx(K,{present:t||a,children:e.jsx(Ae,{"data-state":a?"visible":"hidden",...c,ref:o})})}),cr=l.forwardRef((r,o)=>{const{forceMount:t,...c}=r,n=E(D,r.__scopeScrollArea),a=r.orientation==="horizontal",i=ee(()=>h("SCROLL_END"),100),[u,h]=nr("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(u==="idle"){const m=window.setTimeout(()=>h("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(m)}},[u,n.scrollHideDelay,h]),l.useEffect(()=>{const m=n.viewport,f=a?"scrollLeft":"scrollTop";if(m){let v=m[f];const p=()=>{const g=m[f];v!==g&&(h("SCROLL"),i()),v=g};return m.addEventListener("scroll",p),()=>m.removeEventListener("scroll",p)}},[n.viewport,a,h,i]),e.jsx(K,{present:t||u!=="hidden",children:e.jsx(ue,{"data-state":u==="hidden"?"hidden":"visible",...c,ref:o,onPointerEnter:$(r.onPointerEnter,()=>h("POINTER_ENTER")),onPointerLeave:$(r.onPointerLeave,()=>h("POINTER_LEAVE"))})})}),Ae=l.forwardRef((r,o)=>{const t=E(D,r.__scopeScrollArea),{forceMount:c,...n}=r,[a,i]=l.useState(!1),u=r.orientation==="horizontal",h=ee(()=>{if(t.viewport){const m=t.viewport.offsetWidth<t.viewport.scrollWidth,f=t.viewport.offsetHeight<t.viewport.scrollHeight;i(u?m:f)}},10);return X(t.viewport,h),X(t.content,h),e.jsx(K,{present:c||a,children:e.jsx(ue,{"data-state":a?"visible":"hidden",...n,ref:o})})}),ue=l.forwardRef((r,o)=>{const{orientation:t="vertical",...c}=r,n=E(D,r.__scopeScrollArea),a=l.useRef(null),i=l.useRef(0),[u,h]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=_e(u.viewport,u.content),f={...c,sizes:u,onSizesChange:h,hasThumb:m>0&&m<1,onThumbChange:p=>a.current=p,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:p=>i.current=p};function v(p,g){return fr(p,i.current,u,g)}return t==="horizontal"?e.jsx(ir,{...f,ref:o,onThumbPositionChange:()=>{if(n.viewport&&a.current){const p=n.viewport.scrollLeft,g=we(p,u,n.dir);a.current.style.transform=`translate3d(${g}px, 0, 0)`}},onWheelScroll:p=>{n.viewport&&(n.viewport.scrollLeft=p)},onDragScroll:p=>{n.viewport&&(n.viewport.scrollLeft=v(p,n.dir))}}):t==="vertical"?e.jsx(dr,{...f,ref:o,onThumbPositionChange:()=>{if(n.viewport&&a.current){const p=n.viewport.scrollTop,g=we(p,u);a.current.style.transform=`translate3d(0, ${g}px, 0)`}},onWheelScroll:p=>{n.viewport&&(n.viewport.scrollTop=p)},onDragScroll:p=>{n.viewport&&(n.viewport.scrollTop=v(p))}}):null}),ir=l.forwardRef((r,o)=>{const{sizes:t,onSizesChange:c,...n}=r,a=E(D,r.__scopeScrollArea),[i,u]=l.useState(),h=l.useRef(null),m=V(o,h,a.onScrollbarXChange);return l.useEffect(()=>{h.current&&u(getComputedStyle(h.current))},[h]),e.jsx(ke,{"data-orientation":"horizontal",...n,ref:m,sizes:t,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Q(t)+"px",...r.style},onThumbPointerDown:f=>r.onThumbPointerDown(f.x),onDragScroll:f=>r.onDragScroll(f.x),onWheelScroll:(f,v)=>{if(a.viewport){const p=a.viewport.scrollLeft+f.deltaX;r.onWheelScroll(p),Ie(p,v)&&f.preventDefault()}},onResize:()=>{h.current&&a.viewport&&i&&c({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:h.current.clientWidth,paddingStart:Z(i.paddingLeft),paddingEnd:Z(i.paddingRight)}})}})}),dr=l.forwardRef((r,o)=>{const{sizes:t,onSizesChange:c,...n}=r,a=E(D,r.__scopeScrollArea),[i,u]=l.useState(),h=l.useRef(null),m=V(o,h,a.onScrollbarYChange);return l.useEffect(()=>{h.current&&u(getComputedStyle(h.current))},[h]),e.jsx(ke,{"data-orientation":"vertical",...n,ref:m,sizes:t,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Q(t)+"px",...r.style},onThumbPointerDown:f=>r.onThumbPointerDown(f.y),onDragScroll:f=>r.onDragScroll(f.y),onWheelScroll:(f,v)=>{if(a.viewport){const p=a.viewport.scrollTop+f.deltaY;r.onWheelScroll(p),Ie(p,v)&&f.preventDefault()}},onResize:()=>{h.current&&a.viewport&&i&&c({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:h.current.clientHeight,paddingStart:Z(i.paddingTop),paddingEnd:Z(i.paddingBottom)}})}})}),[ur,Re]=Ne(D),ke=l.forwardRef((r,o)=>{const{__scopeScrollArea:t,sizes:c,hasThumb:n,onThumbChange:a,onThumbPointerUp:i,onThumbPointerDown:u,onThumbPositionChange:h,onDragScroll:m,onWheelScroll:f,onResize:v,...p}=r,g=E(D,t),[y,z]=l.useState(null),M=V(o,b=>z(b)),P=l.useRef(null),L=l.useRef(""),W=g.viewport,R=c.content-c.viewport,_=O(f),H=O(h),q=ee(v,10);function B(b){if(P.current){const C=b.clientX-P.current.left,I=b.clientY-P.current.top;m({x:C,y:I})}}return l.useEffect(()=>{const b=C=>{const I=C.target;y?.contains(I)&&_(C,R)};return document.addEventListener("wheel",b,{passive:!1}),()=>document.removeEventListener("wheel",b,{passive:!1})},[W,y,R,_]),l.useEffect(H,[c,H]),X(y,q),X(g.content,q),e.jsx(ur,{scope:t,scrollbar:y,hasThumb:n,onThumbChange:O(a),onThumbPointerUp:O(i),onThumbPositionChange:H,onThumbPointerDown:O(u),children:e.jsx(G.div,{...p,ref:M,style:{position:"absolute",...p.style},onPointerDown:$(r.onPointerDown,b=>{b.button===0&&(b.target.setPointerCapture(b.pointerId),P.current=y.getBoundingClientRect(),L.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",g.viewport&&(g.viewport.style.scrollBehavior="auto"),B(b))}),onPointerMove:$(r.onPointerMove,B),onPointerUp:$(r.onPointerUp,b=>{const C=b.target;C.hasPointerCapture(b.pointerId)&&C.releasePointerCapture(b.pointerId),document.body.style.webkitUserSelect=L.current,g.viewport&&(g.viewport.style.scrollBehavior=""),P.current=null})})})}),J="ScrollAreaThumb",De=l.forwardRef((r,o)=>{const{forceMount:t,...c}=r,n=Re(J,r.__scopeScrollArea);return e.jsx(K,{present:t||n.hasThumb,children:e.jsx(hr,{ref:o,...c})})}),hr=l.forwardRef((r,o)=>{const{__scopeScrollArea:t,style:c,...n}=r,a=E(J,t),i=Re(J,t),{onThumbPositionChange:u}=i,h=V(o,v=>i.onThumbChange(v)),m=l.useRef(void 0),f=ee(()=>{m.current&&(m.current(),m.current=void 0)},100);return l.useEffect(()=>{const v=a.viewport;if(v){const p=()=>{if(f(),!m.current){const g=pr(v,u);m.current=g,u()}};return u(),v.addEventListener("scroll",p),()=>v.removeEventListener("scroll",p)}},[a.viewport,f,u]),e.jsx(G.div,{"data-state":i.hasThumb?"visible":"hidden",...n,ref:h,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...c},onPointerDownCapture:$(r.onPointerDownCapture,v=>{const g=v.target.getBoundingClientRect(),y=v.clientX-g.left,z=v.clientY-g.top;i.onThumbPointerDown({x:y,y:z})}),onPointerUp:$(r.onPointerUp,i.onThumbPointerUp)})});De.displayName=J;var he="ScrollAreaCorner",Le=l.forwardRef((r,o)=>{const t=E(he,r.__scopeScrollArea),c=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&c?e.jsx(mr,{...r,ref:o}):null});Le.displayName=he;var mr=l.forwardRef((r,o)=>{const{__scopeScrollArea:t,...c}=r,n=E(he,t),[a,i]=l.useState(0),[u,h]=l.useState(0),m=!!(a&&u);return X(n.scrollbarX,()=>{const f=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(f),h(f)}),X(n.scrollbarY,()=>{const f=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(f),i(f)}),m?e.jsx(G.div,{...c,ref:o,style:{width:a,height:u,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function Z(r){return r?parseInt(r,10):0}function _e(r,o){const t=r/o;return isNaN(t)?0:t}function Q(r){const o=_e(r.viewport,r.content),t=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,c=(r.scrollbar.size-t)*o;return Math.max(c,18)}function fr(r,o,t,c="ltr"){const n=Q(t),a=n/2,i=o||a,u=n-i,h=t.scrollbar.paddingStart+i,m=t.scrollbar.size-t.scrollbar.paddingEnd-u,f=t.content-t.viewport,v=c==="ltr"?[0,f]:[f*-1,0];return We([h,m],v)(r)}function we(r,o,t="ltr"){const c=Q(o),n=o.scrollbar.paddingStart+o.scrollbar.paddingEnd,a=o.scrollbar.size-n,i=o.content-o.viewport,u=a-c,h=t==="ltr"?[0,i]:[i*-1,0],m=Fe(r,h);return We([0,i],[0,u])(m)}function We(r,o){return t=>{if(r[0]===r[1]||o[0]===o[1])return o[0];const c=(o[1]-o[0])/(r[1]-r[0]);return o[0]+c*(t-r[0])}}function Ie(r,o){return r>0&&r<o}var pr=(r,o=()=>{})=>{let t={left:r.scrollLeft,top:r.scrollTop},c=0;return(function n(){const a={left:r.scrollLeft,top:r.scrollTop},i=t.left!==a.left,u=t.top!==a.top;(i||u)&&o(),t=a,c=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(c)};function ee(r,o){const t=O(r),c=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(c.current),[]),l.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(t,o)},[t,o])}function X(r,o){const t=O(o);Ye(()=>{let c=0;if(r){const n=new ResizeObserver(()=>{cancelAnimationFrame(c),c=window.requestAnimationFrame(t)});return n.observe(r),()=>{window.cancelAnimationFrame(c),n.unobserve(r)}}},[r,t])}var xr=Ce,vr=Ee,gr=Le;function br({className:r,children:o,...t}){return e.jsxs(xr,{"data-slot":"scroll-area",className:je("relative",r),...t,children:[e.jsx(vr,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:o}),e.jsx(Sr,{}),e.jsx(gr,{})]})}function Sr({className:r,orientation:o="vertical",...t}){return e.jsx(Te,{"data-slot":"scroll-area-scrollbar",orientation:o,className:je("flex touch-none p-px transition-colors select-none",o==="vertical"&&"h-full w-2.5 border-l border-l-transparent",o==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",r),...t,children:e.jsx(De,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function wr({exercise:r,index:o,onUpdate:t,onRemove:c}){const n=r.weight!==void 0||r.exercise.hasWeight||r.exercise.name.toLowerCase().includes("гантел")||r.exercise.name.toLowerCase().includes("штанг")||r.exercise.name.toLowerCase().includes("жим")||r.exercise.name.toLowerCase().includes("тяга")||r.exercise.name.toLowerCase().includes("французский");return e.jsxs("div",{className:"p-4 border rounded-lg space-y-4 bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:r.exercise.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.exercise.category," • ",r.exercise.difficulty]})]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>c(o),className:"text-destructive hover:text-destructive",children:e.jsx(ye,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"text-xs flex items-center gap-1",children:[e.jsx(er,{className:"w-3 h-3"}),"Подходы"]}),e.jsx(F,{type:"number",value:r.sets,onChange:a=>t(o,"sets",parseInt(a.target.value)||1),className:"h-9",min:"1",max:"10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{className:"text-xs",children:"Повторения"}),e.jsx(F,{value:r.reps,onChange:a=>t(o,"reps",a.target.value),className:"h-9",placeholder:"10-12"})]})]}),e.jsxs("div",{className:`grid gap-3 ${n?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"text-xs flex items-center gap-1",children:[e.jsx(Je,{className:"w-3 h-3"}),"Время (сек)"]}),e.jsx(F,{type:"number",value:r.duration,onChange:a=>t(o,"duration",parseInt(a.target.value)||30),className:"h-9",min:"5",max:"300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"text-xs flex items-center gap-1",children:[e.jsx(or,{className:"w-3 h-3"}),"Отдых (сек)"]}),e.jsx(F,{type:"number",value:r.restTime||r.exercise.rest,onChange:a=>t(o,"restTime",parseInt(a.target.value)||0),className:"h-9",min:"0",max:"180"})]}),n&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"text-xs flex items-center gap-1",children:[e.jsx(tr,{className:"w-3 h-3"}),"Вес (кг)"]}),e.jsx(F,{type:"number",value:r.weight||10,onChange:a=>t(o,"weight",parseFloat(a.target.value)||0),className:"h-9",min:"0",max:"200",step:"0.5",placeholder:"10"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>t(o,"duration",Math.max(5,r.duration-10)),className:"text-xs h-7",children:"-10с"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>t(o,"duration",r.duration+10),className:"text-xs h-7",children:"+10с"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>t(o,"restTime",Math.max(0,(r.restTime||r.exercise.rest)-5)),className:"text-xs h-7",children:"Отдых -5с"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>t(o,"restTime",(r.restTime||r.exercise.rest)+5),className:"text-xs h-7",children:"Отдых +5с"})]})]})}const jr=["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"];function Or({onNavigate:r,onStartWorkout:o}){const[t,c]=l.useState([]),[n,a]=l.useState(""),[i,u]=l.useState(""),[h,m]=l.useState([]),[f,v]=l.useState(Ge()),[p,g]=l.useState("all"),[y,z]=l.useState("all"),[M,P]=l.useState(!1),[L,W]=l.useState(!1),[R,_]=l.useState(null);l.useEffect(()=>{H()},[]);const H=async()=>{try{const{data:{session:s}}=await te.auth.getSession();if(!s?.access_token)return;const x=await fetch(`https://${se}.supabase.co/functions/v1/make-server-c6c9ad1a/workout-plan`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(x.ok){const d=await x.json();if(d.planData?.plan?.weekPlan){const S=d.planData.plan.weekPlan.map(w=>({...w,exercises:w.exercises.map(k=>{let j=U.find(re=>re.id===k.exerciseId);return j||(j=U.find(re=>re.name===k.name)),j||(j=U[0],console.warn(`Упражнение не найдено: ${k.name}, используется fallback`)),{...k,exercise:j,uniqueId:k.uniqueId||`${j.id}-${Date.now()}-${Math.random()}`}})}));c(S)}}}catch(s){console.error("Ошибка загрузки плана:",s)}},q=f.filter(s=>{const x=p==="all"||s.category===p,d=y==="all"||s.difficulty===y;return x&&d}),B=Array.from(new Set(U.map(s=>s.category))),b=Array.from(new Set(U.map(s=>s.difficulty))),C=s=>{const x=`${s.id}-${Date.now()}`,d=s.hasWeight||s.name.toLowerCase().includes("гантел")||s.name.toLowerCase().includes("штанг")||s.name.toLowerCase().includes("жим")||s.name.toLowerCase().includes("тяга")||s.name.toLowerCase().includes("французский"),S={exercise:s,sets:3,reps:"10-12",duration:s.duration,weight:d?10:void 0,restTime:s.rest||60,uniqueId:x};m(w=>[...w,S])},I=(s,x,d)=>{m(S=>{const w=[...S];return w[s]={...w[s],[x]:d},w})},me=s=>{m(x=>x.filter((d,S)=>S!==s))},fe=()=>h.reduce((s,x)=>{const d=x.sets*x.duration,S=x.sets*(x.restTime||60);return s+d+S},0),ze=()=>{P(!0),a(""),u(""),m([]),_(null)},Me=s=>{_(s),P(!0),a(s.day),u(s.workoutName),m(s.exercises.map(x=>({...x,uniqueId:x.uniqueId||`${x.exercise.id}-${Date.now()}`})))},He=s=>{c(x=>x.filter(d=>d.day!==s)),T.success("Тренировка удалена")},Oe=async()=>{if(!n||!i||h.length===0){T.error("Заполните все поля");return}W(!0);const s={day:n,workoutName:i,exercises:h.map(d=>({exercise:d.exercise,sets:d.sets,reps:d.reps,duration:d.duration,weight:d.weight,restTime:d.restTime,uniqueId:d.uniqueId})),totalDuration:Math.round(fe()/60)},x=R?t.map(d=>d.day===R.day?s:d):[...t.filter(d=>d.day!==n),s];try{const{data:{session:d}}=await te.auth.getSession();if(!d?.access_token){T.error("Необходима авторизация");return}const S={weekPlan:x.map(k=>({day:k.day,workoutName:k.workoutName,exercises:k.exercises.map(j=>({exerciseId:j.exercise.id,name:j.exercise.name,sets:j.sets,reps:j.reps,duration:j.duration,weight:j.weight,restTime:j.restTime,uniqueId:j.uniqueId})),totalDuration:k.totalDuration})),recommendations:"Персональный план тренировок"};(await fetch(`https://${se}.supabase.co/functions/v1/make-server-c6c9ad1a/manual-workout-plan`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d.access_token}`},body:JSON.stringify({plan:S})})).ok?(c(x),P(!1),m([]),_(null),T.success(R?"Тренировка обновлена":"Тренировка сохранена")):T.error("Ошибка сохранения тренировки")}catch(d){console.error("Ошибка сохранения:",d),T.error("Ошибка сохранения тренировки")}finally{W(!1)}},$e=()=>{P(!1),m([]),_(null)},qe=s=>{const x={id:Date.now(),name:s.workoutName,duration:s.totalDuration,difficulty:"Средне",exercises:s.exercises.length,description:`Персональная тренировка: ${s.workoutName}`,category:"Персональная",exercises_list:s.exercises.map(d=>({id:d.exercise.id,name:d.exercise.name,video:d.exercise.video,duration:d.duration,rest:d.restTime||d.exercise.rest,category:d.exercise.category,difficulty:d.exercise.difficulty,muscleGroups:d.exercise.muscleGroups,hasWeight:d.exercise.hasWeight,sets:d.sets,reps:d.reps,weight:d.weight}))};console.log("Запускаем пользовательскую тренировку:",x),o(x)},Be=async()=>{if(t.length===0){T.error("Добавьте хотя бы одну тренировку");return}W(!0);try{const{data:{session:s}}=await te.auth.getSession();if(!s?.access_token){T.error("Необходима авторизация");return}const x={weekPlan:t.map(S=>({day:S.day,workoutName:S.workoutName,exercises:S.exercises.map(w=>({exerciseId:w.exercise.id,name:w.exercise.name,sets:w.sets,reps:w.reps,duration:w.duration,weight:w.weight,restTime:w.restTime,uniqueId:w.uniqueId})),totalDuration:S.totalDuration})),recommendations:"Персональный план тренировок"};(await fetch(`https://${se}.supabase.co/functions/v1/make-server-c6c9ad1a/manual-workout-plan`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({plan:x})})).ok?(T.success("План тренировок сохранен"),r("plan")):T.error("Ошибка сохранения плана")}catch(s){console.error("Ошибка сохранения плана:",s),T.error("Ошибка сохранения плана")}finally{W(!1)}};return e.jsx("div",{className:"min-h-screen p-4 bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>r("plan"),className:"mr-4",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Назад"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Создание плана тренировок"})]}),!M&&t.length>0&&e.jsx(N,{onClick:Be,disabled:L,children:L?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}),"Сохранение..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Сохранить план"]})})]}),t.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Ваш план тренировок"}),t.map((s,x)=>e.jsxs(pe,{className:"flex flex-col",children:[e.jsxs(xe,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ve,{className:"text-base",children:s.day}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>Me(s),children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>He(s.day),children:e.jsx(ye,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.workoutName})]}),e.jsxs(ge,{className:"flex flex-col flex-1",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[s.exercises.slice(0,3).map((d,S)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"truncate flex-1 mr-2",children:d.exercise.name}),e.jsxs("span",{className:"text-muted-foreground text-xs",children:[d.sets,"×",d.reps,d.weight&&` • ${d.weight}кг`]})]},`${s.day}-${d.exercise.id}-${S}`)),s.exercises.length>3&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-1",children:["+",s.exercises.length-3," упражнений"]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.totalDuration," мин • ",s.exercises.length," упражнений"]}),e.jsx(N,{size:"sm",onClick:()=>qe(s),children:"Начать"})]})]})]},s.day))]}),!M&&e.jsxs(N,{onClick:ze,className:"w-full",variant:"outline",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Добавить тренировку"]}),M&&e.jsxs(pe,{children:[e.jsx(xe,{children:e.jsx(ve,{children:R?"Редактирование тренировки":"Новая тренировка"})}),e.jsxs(ge,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"День недели"}),e.jsxs(oe,{value:n,onValueChange:a,children:[e.jsx(ne,{children:e.jsx(ae,{placeholder:"Выберите день"})}),e.jsx(le,{children:jr.map(s=>e.jsx(Y,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Название тренировки"}),e.jsx(F,{value:i,onChange:s=>u(s.target.value),placeholder:"Например: Силовая тренировка"})]})]}),h.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Выбранные упражнения"}),e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:h.map((s,x)=>e.jsx(wr,{exercise:s,index:x,onUpdate:I,onRemove:me},s.uniqueId||`${s.exercise.id}-${x}`))}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Примерная длительность: ",Math.round(fe()/60)," мин"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-xs",children:"Категория"}),e.jsxs(oe,{value:p,onValueChange:g,children:[e.jsx(ne,{className:"h-8",children:e.jsx(ae,{})}),e.jsxs(le,{children:[e.jsx(Y,{value:"all",children:"Все"}),B.map(s=>e.jsx(Y,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-xs",children:"Сложность"}),e.jsxs(oe,{value:y,onValueChange:z,children:[e.jsx(ne,{className:"h-8",children:e.jsx(ae,{})}),e.jsxs(le,{children:[e.jsx(Y,{value:"all",children:"Все"}),b.map(s=>e.jsx(Y,{value:s,children:s},s))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Добавить упражнения"}),e.jsx(br,{className:"h-60 border rounded",children:e.jsx("div",{className:"p-2 space-y-2",children:q.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground",children:[e.jsx(Xe,{variant:"outline",className:"text-xs",children:s.category}),e.jsx("span",{children:s.difficulty}),e.jsxs("span",{children:[s.duration,"с"]})]})]}),e.jsx(N,{size:"sm",onClick:()=>C(s),variant:"outline",children:e.jsx(Se,{className:"w-4 h-4"})})]},s.id))})})]}),e.jsxs("div",{className:"flex space-x-2 pt-4",children:[e.jsx(N,{variant:"outline",onClick:$e,className:"flex-1",children:"Отмена"}),e.jsx(N,{onClick:Oe,disabled:!n||!i||h.length===0||L,className:"flex-1",children:L?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}),"Сохранение..."]}):R?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Обновить"]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Сохранить"]})})]})]})]})]})})}export{Or as ManualWorkoutPlanPage};
