import{c as C,r as d,s as j,t as n,p as x,j as e,B as i,C as h,a as p,e as v,f as k}from"./index-B7RkBDmu.js";import{B as z}from"./badge-4HUg1KV1.js";import{A as $,a as B,T as M,b as I,c as E,d as F,e as G,f as R,g as H,h as O}from"./alert-dialog-CU5aGQrq.js";import{b as q}from"./exercises-BGJW1MrG.js";import{A as b}from"./arrow-left-DU8czwo7.js";import{T as y}from"./target-Bb8KCOo4.js";import{S as J}from"./square-pen-BaPZaYOj.js";import{C as K}from"./clock-B8yeLv0_.js";import{P as Q}from"./play-BI_r92eU.js";import"./index-By6Rn9_c.js";import"./index-CXZW0Of0.js";import"./Combination-D8diDoBo.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],V=C("pen-line",U);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],N=C("refresh-cw",X);function oe({onNavigate:o,onStartWorkout:D}){const[l,u]=d.useState(null),[A,L]=d.useState(!0),[m,g]=d.useState(!1);d.useEffect(()=>{P()},[]);const P=async()=>{try{const{data:{session:s}}=await j.auth.getSession();if(!s?.access_token){n.error("Необходима авторизация");return}const r=await fetch(`https://${x}.supabase.co/functions/v1/make-server-c6c9ad1a/workout-plan`,{headers:{Authorization:`Bearer ${s.access_token}`}}),t=await r.json();r.ok&&t.planData&&u(t.planData)}catch(s){console.error("Ошибка загрузки плана:",s),n.error("Ошибка загрузки плана тренировок")}finally{L(!1)}},w=async()=>{g(!0);try{const{data:{session:s}}=await j.auth.getSession();if(!s?.access_token){n.error("Необходима авторизация");return}const r=await fetch(`https://${x}.supabase.co/functions/v1/make-server-c6c9ad1a/profile`,{headers:{Authorization:`Bearer ${s.access_token}`}}),t=await r.json();if(!r.ok||!t.profile){n.error("Не удалось получить профиль пользователя");return}const a=t.profile,f=await fetch(`https://${x}.supabase.co/functions/v1/make-server-c6c9ad1a/generate-workout-plan`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({goals:a.fitnessGoals||"Улучшение общей физической формы",fitnessLevel:a.fitnessLevel||"Начинающий",limitations:a.limitations||"Нет ограничений",preferences:a.preferences||"Разнообразные тренировки"})}),c=await f.json();if(f.ok&&c.plan){const _={plan:c.plan,goals:a.fitnessGoals||"Улучшение общей физической формы",fitnessLevel:a.fitnessLevel||"Начинающий",limitations:a.limitations||"Нет ограничений",createdAt:new Date().toISOString()};u(_),n.success("Новый план тренировок сгенерирован")}else n.error(`Ошибка генерации плана: ${c.error}`)}catch(s){console.error("Ошибка генерации плана:",s),s instanceof TypeError&&s.message.includes("Failed to fetch")?n.error("Сервер недоступен. Попробуйте позже."):n.error("Произошла ошибка при генерации плана")}finally{g(!1)}},T=s=>{const r=s.exercises.map(a=>({...q.find(c=>c.name.toLowerCase().includes(a.name.toLowerCase())||a.name.toLowerCase().includes(c.name.toLowerCase())),sets:a.sets,reps:a.reps,duration:a.duration,weight:a.weight,restTime:a.restTime,planName:a.name})).filter(Boolean),t={id:Date.now(),name:s.workoutName,duration:s.totalDuration,exercises:r.length,exercises_list:r,difficulty:"medium",category:"Тренировка по плану",description:s.workoutName};console.log("WorkoutPlanPage запускает тренировку:",t),console.log("Exercises list:",r),D(t)},S=async()=>{try{const{data:{session:s}}=await j.auth.getSession();if(!s?.access_token){n.error("Необходима авторизация");return}(await fetch(`https://${x}.supabase.co/functions/v1/make-server-c6c9ad1a/workout-plan`,{method:"DELETE",headers:{Authorization:`Bearer ${s.access_token}`}})).ok?(u(null),n.success("План тренировок удален")):n.error("Ошибка удаления плана")}catch(s){console.error("Ошибка удаления плана:",s),n.error("Ошибка удаления плана")}};return A?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):l?e.jsx("div",{className:"min-h-screen p-4 bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>o("home"),className:"mr-4",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Назад"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Ваш план тренировок"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(i,{variant:"outline",onClick:()=>o("manual-plan"),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Редактировать"]}),e.jsxs(i,{variant:"outline",onClick:w,disabled:m,children:[m?e.jsx(N,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(N,{className:"w-4 h-4 mr-2"}),"Новый план"]}),e.jsxs($,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Удалить"]})}),e.jsxs(I,{children:[e.jsxs(E,{children:[e.jsx(F,{children:"Удалить план тренировок?"}),e.jsx(G,{children:"Это действие нельзя отменить. Ваш текущий план тренировок будет удален навсегда."})]}),e.jsxs(R,{children:[e.jsx(H,{children:"Отмена"}),e.jsx(O,{onClick:S,children:"Удалить"})]})]})]})]})]}),e.jsxs(h,{className:"mb-6",children:[e.jsx(v,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Информация о плане"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Цели"}),e.jsx("p",{className:"text-sm",children:l.goals})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Уровень"}),e.jsx("p",{className:"text-sm",children:l.fitnessLevel})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Ограничения"}),e.jsx("p",{className:"text-sm",children:l.limitations||"Нет"})]})]}),l.plan.recommendations&&e.jsxs("div",{className:"mt-4 p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Рекомендации:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.plan.recommendations})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Недельный план"}),l.plan.weekPlan.map((s,r)=>e.jsxs(h,{className:"overflow-hidden",children:[e.jsx(v,{className:"pb-3",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"text-lg",children:s.day}),e.jsxs(z,{variant:"secondary",className:"text-xs",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),s.totalDuration," мин"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.workoutName})]})})}),e.jsxs(p,{className:"pt-0 flex flex-col flex-1",children:[e.jsxs("div",{className:"space-y-2 mb-4 flex-1",children:[s.exercises.slice(0,3).map((t,a)=>e.jsxs("div",{className:"text-sm p-2 bg-muted/50 rounded",children:[e.jsx("p",{className:"font-medium truncate",children:t.name}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[t.sets," подхода × ",t.reps]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{children:[t.duration,"с"]}),t.weight&&e.jsxs("span",{children:["• ",t.weight,"кг"]}),t.restTime&&e.jsxs("span",{children:["• отдых ",t.restTime,"с"]})]})]})]},a)),s.exercises.length>3&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center py-1",children:["+",s.exercises.length-3," упра��нений"]})]}),e.jsxs(i,{className:"w-full mt-auto",onClick:()=>T(s),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Начать тренировку"]})]})]},r))]}),l.plan.weekPlan.length===0&&e.jsx(h,{className:"text-center py-8",children:e.jsx(p,{children:e.jsx("p",{className:"text-muted-foreground",children:"План тренировок пуст. Попробуйте сгенерировать новый план."})})})]})}):e.jsx("div",{className:"min-h-screen p-4 bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>o("home"),className:"mr-4",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Назад"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"План тренировок"})]}),e.jsx(h,{className:"text-center",children:e.jsx(p,{className:"pt-6 pb-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"У вас еще нет плана тренировок"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:"Создайте персонализированный план тренировок, который подойдет именно вам"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx(i,{onClick:w,disabled:m,size:"lg",className:"min-w-[200px]",children:m?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 mr-2 animate-spin"}),"Создание плана..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Автоматический план"]})}),e.jsxs(i,{variant:"outline",onClick:()=>o("manual-plan"),size:"lg",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Создать вручную"]})]})]})})})]})})}export{oe as WorkoutPlanPage};
