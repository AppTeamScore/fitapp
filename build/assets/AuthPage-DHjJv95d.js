import{r as u,j as e,C as y,e as v,f as b,g as N,a as C,B as h,s as T,t as i,p as S,h as D}from"./index-B7RkBDmu.js";import{I as n}from"./input-D0dNSjS9.js";import{L as t}from"./label-D7l1fsoW.js";import{T as F,a as L,b as g,c as x}from"./tabs-7IzPxeVw.js";import"./index-By6Rn9_c.js";import"./index-CXZW0Of0.js";import"./index-CfusklFX.js";import"./index-CIMocV2O.js";function O({onAuthSuccess:f}){const[o,c]=u.useState(!1),[l,p]=u.useState({email:"",password:""}),[s,d]=u.useState({email:"",password:"",name:"",confirmPassword:""}),j=async a=>{a.preventDefault(),c(!0);try{const{data:r,error:m}=await T.auth.signInWithPassword({email:l.email,password:l.password});if(m){i.error(`Ошибка входа: ${m.message}`);return}r.session?.access_token&&(i.success("Успешный вход!"),f(r.user))}catch(r){console.error("Ошибка входа:",r),i.error("Произошла ошибка при входе")}finally{c(!1)}},w=async a=>{if(a.preventDefault(),s.password!==s.confirmPassword){i.error("Пароли не совпадают");return}if(s.password.length<6){i.error("Пароль должен содержать минимум 6 символов");return}c(!0);try{const r=await fetch(`https://${S}.supabase.co/functions/v1/make-server-c6c9ad1a/signup`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${D}`},body:JSON.stringify({email:s.email,password:s.password,userData:{name:s.name}})}),m=await r.json();if(!r.ok){i.error(`Ошибка регистрации: ${m.error}`);return}i.success("Регистрация успешна! Теперь войдите в систему"),p({email:s.email,password:""})}catch(r){console.error("Ошибка регистрации:",r),r instanceof TypeError&&r.message.includes("Failed to fetch")?i.error("Не удается подключиться к серверу. Проверьте интернет-соединение."):i.error("Произошла ошибка при регистрации")}finally{c(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-primary/10 via-background to-secondary/10",children:e.jsxs(y,{className:"w-full max-w-md",children:[e.jsxs(v,{className:"text-center",children:[e.jsx(b,{className:"text-2xl",children:"FitApp"}),e.jsx(N,{children:"Ваш персональный тренер в кармане"})]}),e.jsx(C,{children:e.jsxs(F,{defaultValue:"login",className:"w-full",children:[e.jsxs(L,{className:"grid w-full grid-cols-2",children:[e.jsx(g,{value:"login",children:"Вход"}),e.jsx(g,{value:"signup",children:"Регистрация"})]}),e.jsx(x,{value:"login",children:e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"login-email",children:"Email"}),e.jsx(n,{id:"login-email",type:"email",placeholder:"your@email.com",value:l.email,onChange:a=>p({...l,email:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"login-password",children:"Пароль"}),e.jsx(n,{id:"login-password",type:"password",placeholder:"••••••••",value:l.password,onChange:a=>p({...l,password:a.target.value}),required:!0})]}),e.jsx(h,{type:"submit",className:"w-full",disabled:o,children:o?"Вход...":"Войти"})]})}),e.jsx(x,{value:"signup",children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"signup-name",children:"Имя"}),e.jsx(n,{id:"signup-name",type:"text",placeholder:"Ваше имя",value:s.name,onChange:a=>d({...s,name:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"signup-email",children:"Email"}),e.jsx(n,{id:"signup-email",type:"email",placeholder:"your@email.com",value:s.email,onChange:a=>d({...s,email:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"signup-password",children:"Пароль"}),e.jsx(n,{id:"signup-password",type:"password",placeholder:"••••••••",value:s.password,onChange:a=>d({...s,password:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"signup-confirm",children:"Подтверждение пароля"}),e.jsx(n,{id:"signup-confirm",type:"password",placeholder:"••••••••",value:s.confirmPassword,onChange:a=>d({...s,confirmPassword:a.target.value}),required:!0})]}),e.jsx(h,{type:"submit",className:"w-full",disabled:o,children:o?"Регистрация...":"Зарегистрироваться"})]})})]})})]})})}export{O as AuthPage};
